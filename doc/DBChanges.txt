
--Alteração em 10/06/2010 ################################################################################################

DROP TABLE resivion_status cascade;

CREATE TABLE revision_status
(
	rst_id_in            INTEGER NOT NULL ,
	rst_description_ch   VARCHAR(64) NOT NULL ,
CONSTRAINT  XPKresivion_status PRIMARY KEY (rst_id_in)
);

insert into revision_status ( rst_id_in, rst_description_ch ) values ( 1, 'Sem revisão' );
insert into revision_status ( rst_id_in, rst_description_ch ) values ( 2, 'Em revisão' );
insert into revision_status ( rst_id_in, rst_description_ch ) values ( 3, 'Revisado' );


alter table pgc
add column rst_id_in            INTEGER NOT NULL default 1;

alter table pgc
add CONSTRAINT FK_RevisionStatus_Pgc FOREIGN KEY (rst_id_in) REFERENCES revision_status (rst_id_in);

CREATE  INDEX XIF3pgc ON pgc
(rst_id_in   ASC);

GRANT SELECT, INSERT, UPDATE, DELETE ON revision_status TO cloud;


DROP TABLE IF EXISTS client CASCADE ;



CREATE TABLE client
(
	usr_id_in            INTEGER NOT NULL ,
	cli_id_in            INTEGER NOT NULL ,
	cli_from_dt          TIMESTAMP NOT NULL ,
	cli_to_dt            TIMESTAMP NULL ,
	cli_seq_in           INTEGER NOT NULL ,
CONSTRAINT  XPKClients PRIMARY KEY (usr_id_in,cli_seq_in),
CONSTRAINT FK_Company_Client FOREIGN KEY (usr_id_in) REFERENCES company (usr_id_in),
CONSTRAINT FK_User_Client FOREIGN KEY (cli_id_in) REFERENCES users (usr_id_in)
)
	TABLESPACE tb_cloud_data;



COMMENT ON TABLE client IS 'Tabela de clientes. Um cliente está sempre vinculado a uma EMPRESA nunca a uma pessoa.';




COMMENT ON COLUMN client.usr_id_in IS 'Usar sequence: seq_usuario';




COMMENT ON COLUMN client.cli_id_in IS 'Usar sequence: seq_usuario';



CREATE  INDEX XIF1Clients ON client
(usr_id_in   ASC);



CREATE  INDEX XIF2Clients ON client
(cli_id_in   ASC);



GRANT SELECT, INSERT, UPDATE, DELETE ON client TO cloud;


alter table pgc_page
add column rst_id_in            INTEGER NOT NULL default 1;

alter table pgc_page
add CONSTRAINT FK_RevisionStatus_Pgc FOREIGN KEY (rst_id_in) REFERENCES revision_status (rst_id_in);


--Alteracao em 10/07/2010 ################################################################################################

DROP TABLE IF EXISTS anoto_pen_user CASCADE ;



CREATE TABLE anoto_pen_user
(
	usr_id_in            INTEGER NOT NULL ,
	apu_seq_in           INTEGER NOT NULL ,
	apu_from_dt          TIMESTAMP DEFAULT  now()  NOT NULL ,
	apu_to_dt            TIMESTAMP NULL ,
	pen_id_ch            VARCHAR(16) NOT NULL ,
	frm_id_in            INTEGER NOT NULL ,
	apg_id_ch            VARCHAR(16) NOT NULL ,
	pad_id_in            INTEGER NOT NULL ,
CONSTRAINT  XPKAnoto_Pen_User PRIMARY KEY (frm_id_in,pad_id_in,apg_id_ch,pen_id_ch,apu_seq_in) USING INDEX TABLESPACE TB_CLOUD_INDEX ,
CONSTRAINT FK_PenUser_User FOREIGN KEY (usr_id_in) REFERENCES person (usr_id_in),
CONSTRAINT FK_PenUser_PenPage FOREIGN KEY (pen_id_ch, frm_id_in, apg_id_ch, pad_id_in) REFERENCES anoto_pen_page (pen_id_ch, frm_id_in, apg_id_ch, pad_id_in)
);




COMMENT ON COLUMN anoto_pen_user.usr_id_in IS 'Usar sequence: seq_usuario';




COMMENT ON COLUMN anoto_pen_user.pad_id_in IS 'Código sequencial da media. Este código é gerado por sequence (seq_media).';



GRANT SELECT, INSERT, UPDATE, DELETE ON anoto_pen_user TO cloud;



--##########################################################################################################################

DROP TABLE IF EXISTS pgc_pen_page CASCADE ;



DROP TABLE IF EXISTS anoto_pen_page CASCADE ;



CREATE TABLE anoto_pen_page
(
	pen_id_ch            VARCHAR(16) NOT NULL ,
	pdp_insert_dt        TIMESTAMP DEFAULT  now()  NULL ,
	frm_id_in            INTEGER NOT NULL ,
	apg_id_ch            VARCHAR(16) NOT NULL ,
	pad_id_in            INTEGER NOT NULL ,
	pdp_seq_in           INTEGER NOT NULL ,
	pdp_to_dt            TIMESTAMP NULL ,
CONSTRAINT  FormPenPAD_PK PRIMARY KEY (frm_id_in,apg_id_ch,pad_id_in,pdp_seq_in) USING INDEX TABLESPACE TB_CLOUD_INDEX ,CONSTRAINT  UK_PenPage UNIQUE (pen_id_ch,apg_id_ch) USING INDEX TABLESPACE TB_CLOUD_INDEX ,
CONSTRAINT FK_Pen_Pads FOREIGN KEY (pen_id_ch) REFERENCES anoto_pen (pen_id_ch),
CONSTRAINT FK_AnotoPage_AnotoPenPage FOREIGN KEY (frm_id_in, apg_id_ch, pad_id_in) REFERENCES anoto_page (frm_id_in, apg_id_ch, pad_id_in) ON DELETE CASCADE
);



COMMENT ON TABLE anoto_pen_page IS 'Cadastro de vinculação entre a caneta e uma malha, que por sua vez, está vinculado a um formulário. Um detalhe importante: uma caneta NÃO pode estar vinculado a mais de uma malha com o mesmo endereço, porém um mesmo número de malha(também conhecido como ip) pode estar associado a mais de uma aplicação.


';




COMMENT ON COLUMN anoto_pen_page.pad_id_in IS 'Código sequencial da media. Este código é gerado por sequence (seq_media).';



GRANT SELECT, INSERT, UPDATE, DELETE ON anoto_pen_page TO cloud;



CREATE TABLE pgc_pen_page
(
	pgc_id_in            INTEGER NOT NULL ,
	frm_id_in            INTEGER NOT NULL ,
	apg_id_ch            VARCHAR(16) NOT NULL ,
	pad_id_in            INTEGER NOT NULL ,
	pdp_seq_in           INTEGER NOT NULL ,
CONSTRAINT  XPKpgc_pen_page PRIMARY KEY (pgc_id_in,frm_id_in,apg_id_ch,pad_id_in,pdp_seq_in) USING INDEX TABLESPACE TB_CLOUD_INDEX ,
CONSTRAINT FK_PgcPenPage_Pgc FOREIGN KEY (pgc_id_in) REFERENCES pgc (pgc_id_in) ON DELETE CASCADE,
CONSTRAINT FK_AnotoPenPage_PgcPenPage FOREIGN KEY (frm_id_in, apg_id_ch, pad_id_in, pdp_seq_in) REFERENCES anoto_pen_page (frm_id_in, apg_id_ch, pad_id_in, pdp_seq_in)
);




COMMENT ON COLUMN pgc_pen_page.pgc_id_in IS 'Código sequencial da media. Este código é gerado por sequence (seq_media).';




COMMENT ON COLUMN pgc_pen_page.pad_id_in IS 'Código sequencial da media. Este código é gerado por sequence (seq_media).';



CREATE  INDEX AK_PenPageForm ON pgc_pen_page
(frm_id_in   ASC);



GRANT SELECT, INSERT, UPDATE, DELETE ON pgc_pen_page TO cloud;
